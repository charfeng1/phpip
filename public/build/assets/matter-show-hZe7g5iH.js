import{f as v,p as b,r as u}from"./app-BNcfSzD8.js";import"./alpine-BkKOMYu4.js";let L=()=>window.contentSrc||"",P=a=>{window.contentSrc=a};function T(){window.Alpine&&window.Alpine.data("imageUpload",a=>({expanded:a.hasImage||!1,imageUrl:a.imageUrl||"",classifierId:a.classifierId||null,matterId:a.matterId,showControls:!1,async uploadImage(s){if(!s||!s.type.startsWith("image/"))return;const n=new FormData;n.append("matter_id",this.matterId),n.append("type_code","IMG"),n.append("image",s);try{const c=await fetch("/classifier",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.head.querySelector("[name=csrf-token]").content},body:n});if(c.ok){const f=await c.text();this.classifierId=parseInt(f),this.imageUrl="/classifier/"+f+"/img",this.showControls=!1}}catch(c){console.error("Upload failed:",c)}},async deleteImage(){if(!(!this.classifierId||!confirm(window.appConfig?.translations?.deleteImageConfirm||"Delete this image?")))try{await v("/classifier/"+this.classifierId,"DELETE")&&(this.imageUrl="",this.classifierId=null,this.expanded=!1,this.showControls=!1)}catch(s){console.error("Delete failed:",s)}},handleDrop(s){s.preventDefault(),s.stopPropagation();const n=s.dataTransfer.files[0];n&&this.uploadImage(n)}}))}function R(){let a=null,s=null,n=null;function c(){return a||(a=document.createElement("div"),a.id="actorPopover",a.className="absolute z-50 bg-base-100 border border-base-300 rounded-lg shadow-lg p-2 w-72",a.innerHTML=actorPopoverTemplate.content.firstElementChild.outerHTML,a.style.display="none",document.body.appendChild(a)),a}function f(){const e=c(),t=e.querySelector("#actorName"),o=e.querySelector("#roleName");s&&t&&(t.removeEventListener("acCompleted",s),s=null),n&&o&&(o.removeEventListener("acCompleted",n),n=null)}function p(){const e=c();e.style.display="none";const t=e.querySelector("#addActorForm");t&&t.reset(),f()}function S(e){const t=c(),o=t.querySelector("#addActorForm"),r=t.querySelector("#roleName"),l=t.querySelector("#actorName"),h=t.querySelector("#actorShared"),y=t.querySelector("#actorNotShared"),w=e.getBoundingClientRect();t.style.position="fixed",t.style.top=w.bottom+5+"px",t.style.left=Math.max(10,w.left-100)+"px",t.style.display="block",e.hasAttribute("data-role_code")?(o.role.value=e.dataset.role_code,r.setAttribute("placeholder",e.dataset.role_name),o.shared.value=e.dataset.shareable,e.dataset.shareable==="1"?h.checked=!0:y.checked=!0,l.focus()):(o.role.value="",r.setAttribute("placeholder","Role"),o.shared.value="1",h.checked=!0,r.focus()),s=d=>{const i=d.detail;i.key==="create"?v("/actor","POST",new URLSearchParams("name="+i.value.toUpperCase()+"&default_role="+o.role.value)).then(m=>{o.actor_id.value=m.id,l.classList.add("input-success"),l.value=m.name}):o.actor_id.value=i.key},l.addEventListener("acCompleted",s),n=d=>{const i=d.detail;o.shared.value=i.shareable,i.shareable?h.checked=!0:y.checked=!0},r.addEventListener("acCompleted",n),h.onclick=()=>{o.shared.value="1"},y.onclick=()=>{o.shared.value="0"};const g=t.querySelector("#addActorSubmit");g.onclick=()=>{const d=new FormData(o),i=new URLSearchParams(d);v("/actor-pivot","POST",i).then(m=>{m.errors?b(m.errors,o):(p(),u(window.location.href,"actorPanel"))})};const k=t.querySelector("#popoverCancel");k.onclick=()=>{p()}}if(document.addEventListener("click",e=>{const t=e.target.closest(".add-actor-btn");if(t){e.preventDefault(),e.stopPropagation(),c().style.display==="block"&&p(),S(t);return}a&&a.style.display==="block"&&(a.contains(e.target)||p())}),titlePanel&&!titlePanel.querySelector("dt")){const e=titlePanel.querySelector('[role="button"]');e&&e.click()}titlePanel&&(titlePanel.onclick=e=>{if(e.target.id=="addTitleSubmit"){const t=new FormData(addTitleForm),o=new URLSearchParams(t);v("/classifier","POST",o).then(r=>{r.errors?(b(r.errors,addTitleForm),footerAlert&&(footerAlert.innerHTML=r.message,footerAlert.classList.add("alert-error"))):u(window.location.href,"titlePanel")})}}),ajaxModal.addEventListener("close",e=>{switch(L().split("/")[5]){case"roleActors":u(window.location.href,"actorPanel");break;case"events":case"tasks":case"renewals":case"classifiers":u(window.location.href,"multiPanel");break;case"edit":u(window.location.href,"refsPanel");break}P("")}),ajaxModal.onclick=e=>{switch(e.target.id){case"sumButton":var t=document.getElementById("tocopy"),o=getSelection();o.removeAllRanges();var r=document.createRange();r.selectNodeContents(t),o.addRange(r);var l=document.execCommand("copy");return o.removeAllRanges(),l;case"addTaskReset":e.target.closest("tr").innerHTML="";break}},dropZone.ondragover=function(){return this.classList.remove("bg-info"),this.classList.add("bg-primary"),!1},dropZone.ondragleave=function(){return this.classList.remove("bg-primary"),this.classList.add("bg-info"),!1},dropZone.ondrop=function(e){e.preventDefault(),this.classList.add("bg-info"),this.classList.remove("bg-primary");var t=e.dataTransfer.files[0],o=new FormData;return o.append("file",t),fetch(this.dataset.url,{headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.head.querySelector("[name=csrf-token]").content},method:"POST",body:o}).then(r=>{if(!r.ok)throw r.status==422&&alert("Only DOCX files can be processed for the moment"),new Error("Response status "+r.status);return r.blob()}).then(r=>{var l=document.createElement("a");l.style.display="none",l.href=URL.createObjectURL(r),l.download=uid.outerText+"-"+t.name,document.body.appendChild(l),l.click(),document.body.removeChild(l)}).catch(r=>{console.error(r)}),!1}}export{R as initMatterShow,T as registerImageUpload};
